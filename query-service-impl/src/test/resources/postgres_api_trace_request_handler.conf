{
  name = api-traces-view-handler
  type = postgres
  clientConfig = postgres
  requestHandlerInfo = {
    tenantColumnName: customer_id
    startTimeAttributeName = "EVENT.startTime"
    tableDefinition = {
      tableName = span-event-view
      retentionTimeMillis = 691200000 # 8 days
      timeGranularityMillis = 60000   # 1 min
      mapFields = ["tags", "request_headers", "request_cookies", "request_params", "response_headers", "response_cookies", "response_cookies_metadata", "api_callee_name_count", "path_params", "query_params"]
      bytesFields = ["span_id", "api_trace_id", "trace_id", "parent_span_id"]
      arrayFields = ["sensitive_data_types", "user_roles", "ip_types", "client_session_ids"]
      fieldMap = {
        "API_TRACE.apiName" : "api_name",
        "API_TRACE.apiId" : "api_id",
        "API_TRACE.serviceName" : "service_name",
        "API_TRACE.serviceId": "service_id",
        "SERVICE.hostHeader" : "host_header",
        "API_TRACE.apiTraceId" : "api_trace_id",
        "EVENT.startTime": "start_time_millis",
        "API_TRACE.endTime": "end_time_millis",
        "API_TRACE.traceId" : "trace_id",
        "API_TRACE.duration": "duration_millis",
        "API_TRACE.protocol": "protocol_name",
        "API_TRACE.statusCode": "status_code",
        "API_TRACE.apiBoundaryType" : "api_boundary_type",
        "API_TRACE.userAgent" : "user_agent",
        "API_TRACE.requestHeaders" : "request_headers",
        "API_TRACE.requestCookies" : "request_cookies",
        "API_TRACE.requestBody" : "request_body",
        "API_TRACE.responseHeaders" : "response_headers",
        "API_TRACE.responseCookies" : "response_cookies",
        "API_TRACE.responseCookiesMetadata" : "response_cookies_metadata",
        "API_TRACE.responseBody" : "response_body",
        "API_TRACE.tags" : "tags",
        "API_TRACE.status" : "status",
        "API_TRACE.statusMessage" : "status_message",
        "API_TRACE.requestBodyType" : "request_body_type",
        "API_TRACE.responseBodyType" : "response_body_type",
        "API_TRACE.requestMethod" : "request_method",
        "API_TRACE.requestUrl" : "request_url",
        "API_TRACE.calls" : "api_trace_count",
        "API_TRACE.apiHasPii" : "api_has_pii",
        "API_TRACE.userIdentifier" : "user_identifier",
        "API.isExternal" : "api_is_external",
        "API_TRACE.errorCount" : "error_count",
        "API_TRACE.apiDiscoveryState" : "api_discovery_state",
        "API_TRACE.userIdentifier" : "user_identifier",
        "API_TRACE.userRoles" : "user_roles",
        "API_TRACE.userScore" : "user_score",
        "API_TRACE.userScope": "user_scope",
        "API_TRACE.userCountry": "user_country",
        "API_TRACE.userState": "user_state",
        "API_TRACE.userCity": "user_city",
        "API_TRACE.userLatitude": "user_latitude",
        "API_TRACE.userLongitude": "user_longitude",
        "API_TRACE.ipAddress" : "ip_address",
        "API_TRACE.sessionId" : "session_id",
        "API_TRACE.requestParams" : "request_params",
        "API_TRACE.requestSize": "bytes_received",
        "API_TRACE.responseSize": "bytes_sent",
        "API_TRACE.spaceIds": "space_ids",
        "API_TRACE.ipTypes": "ip_types",
        "API_TRACE.clientSessionIds": "client_session_ids",
        "EVENT.isIpExternal": "is_ip_external",
        "DOMAIN.id": "domain_id",
        "DOMAIN.name": "domain_name",
        "EVENT.environment": "environment",
        "API_TRACE.apiExitCalls": "api_exit_calls",
        "API_TRACE.apiCalleeNameCount" : "api_callee_name_count",
        "API_TRACE.apiTraceErrorSpanCount": "api_trace_error_span_count",
        "EVENT.isBare": "is_bare",
        "EVENT.isSampled": "is_sampled",
        "EVENT.ipIsProxy": "ip_is_proxy",
        "EVENT.ipIsVpn": "ip_is_vpn",
        "EVENT.ipIsTor": "ip_is_tor",
        "EVENT.ipIsBot": "ip_is_bot",
        "EVENT.ipIsScanner": "ip_is_scanner",
        "EVENT.ipReputationScore": "ip_reputation_score",
        "EVENT.ipReputationLevel": "ip_reputation_level",
        "EVENT.scannerType": "scanner_type",
        "EVENT.ipAbuseVelocity": "ip_abuse_velocity",
        "EVENT.ipConnectionType": "ip_connection_type",
        "EVENT.ipOrganisation": "ip_organisation",
        "EVENT.ipAsn": "ip_asn",
        "API_TRACE.processingMode": "processing_mode",
        "API_TRACE.sensitiveDataTypeIds": "sensitive_data_types",
        "API_TRACE.pathParams": "path_params",
        "API_TRACE.queryParams": "query_params"
      }
    }
  }
}